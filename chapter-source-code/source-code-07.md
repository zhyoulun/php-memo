## 基本TCP客户端/服务端程序的套接字交互流程图

![](../images/source-code-003.png)

服务端首先启动，稍后某个时刻客户端启动，它试图连接到服务端。我们假设客户端给服务端一个请求，服务端处理该请求，并且给客户端发回一个响应。这个过程一直持续下去，直到客户关闭连接的客户端，从而给服务端发送一个EOF（文件结束）通知为止。服务器接着也关闭连接服务端，然后结束运行或者等待新的客户连接。

服务端

- socket() 创建服务端的套接字描述符`server_sock`
- bind() 把一个本地协议地址赋予给一个套接字，即给`serv_sock`设置一下`server_addr`
- listen() 当socket()函数创建一个套接字时，它被假设为一个主动套接字，也就是说，它是一个将调用connect发起连接的客户端套接字。listen函数把一个未连接的套接字转换成为一个被动套接字，指示内核应接受指向该套接字的连接请求。
- accept() 从已完成连接队列队头返回下一个已完成连接。如果已完成连接队列为空，那么进程被投入睡眠。
- close() 关闭套接字

客户端

- socket() 创建客户端的套接字描述符`client_sock`
- connect() 客户端使用该函数建立与服务端的连接
- close() 关闭套接字

### 参考

- 《Unix网络编程协议卷1：套接字联网API》